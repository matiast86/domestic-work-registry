<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragments/layout}"
>
  <head>
    <title>Lista de Recibos</title>
  </head>

  <body>
    <div layout:fragment="content" class="container mt-5">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Recibos del Empleado</h2>
        <a
          th:href="@{/payslips/create/{contractId}(contractId=${contractId})}"
          class="btn btn-primary"
        >
          + Nuevo Recibo
        </a>
      </div>

      <!-- Success message -->
      <div
        th:if="${successMessage}"
        class="alert alert-success alert-dismissible fade show"
        role="alert"
      >
        <span th:text="${successMessage}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>

      <!-- Empty state -->
      <div
        th:if="${#lists.isEmpty(payslips)}"
        class="alert alert-warning text-center"
      >
        No se han generado recibos aún para este contrato.
      </div>

      <!-- Table -->
      <div th:if="${!#lists.isEmpty(payslips)}">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr class="text-center">
              <th>Período</th>
              <th>Salario Bruto</th>
              <th>Salario Neto</th>
              <th>Estado</th>
              <th>Generado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="payslip : ${payslips}">
              <td
                class="text-center"
                th:text="${#temporals.monthName(payslip.month)} + ' ' + ${payslip.year}"
              ></td>

              <td
                class="text-end"
                th:text="${#numbers.formatDecimal(payslip.grossSalary, 1, 'COMMA', 2, 'POINT')}"
              ></td>
              <td
                class="text-end"
                th:text="${#numbers.formatDecimal(payslip.netSalary, 1, 'COMMA', 2, 'POINT')}"
              ></td>

              <td class="text-center">
                <span
                  class="badge"
                  th:classappend="${payslip.status.name() == 'DRAFT'} ? 'bg-warning text-dark' :
                                  ${payslip.status.name() == 'FINALIZED'} ? 'bg-success' :
                                  ${payslip.status.name() == 'CANCELLED'} ? 'bg-danger' : 'bg-secondary'"
                  th:text="${payslip.status.label}"
                ></span>
              </td>

              <td
                class="text-center"
                th:text="${#temporals.format(payslip.generatedAt, 'dd/MM/yyyy')}"
              ></td>

              <td class="text-center">
                <div class="btn-group">
                  <a
                    th:href="@{/payslips/details/{id}(id=${payslip.id})}"
                    class="btn btn-outline-primary btn-sm"
                    title="Ver Detalle"
                  >
                    <i class="bi bi-eye"></i>
                  </a>

                  <a
                    th:href="@{/payslips/pdf/{id}(id=${payslip.id})}"
                    class="btn btn-outline-success btn-sm"
                    title="Descargar PDF"
                  >
                    <i class="bi bi-file-earmark-pdf"></i>
                  </a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
