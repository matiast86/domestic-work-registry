<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragments/layout}"
>
  <head>
    <title>Registro de Asistencia</title>
  </head>

  <body>
    <div layout:fragment="content" class="container mt-5">
      <h2 class="mb-4">
        Registro de Asistencia
        <small class="text-muted"
          >(Mes: <span th:text="${monthName}"></span>
          <span th:text="${year}"></span>)</small
        >
      </h2>

      <!-- Alert -->
      <div
        th:if="${successMessage}"
        class="alert alert-success alert-dismissible fade show"
        role="alert"
      >
        <span th:text="${successMessage}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>

      <!-- Table -->
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>Fecha</th>
            <th>Día</th>
            <th>Estado</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="record : ${attendanceRecords}">
            <td th:text="${#temporals.format(record.date, 'dd/MM/yyyy')}"></td>
            <td th:text="${record.date.dayOfWeek}"></td>

            <!-- Color-coded badge -->
            <td>
              <span
                th:switch="${record.attendanceStatus}"
                class="badge fs-6"
                th:classappend="${record.attendanceStatus.name() == 'PRESENT'} ? 'bg-success' :
                                ${record.attendanceStatus.name() == 'ABSENT_UNJUSTIFIED'} ? 'bg-danger' :
                                ${record.attendanceStatus.name() == 'ABSENT_JUSTIFIED'} ? 'bg-warning text-dark' :
                                ${record.attendanceStatus.name() == 'HOLIDAY'} ? 'bg-info text-dark' :
                                'bg-secondary'"
                th:text="${record.attendanceStatus}"
              >
                Estado
              </span>
            </td>

            <!-- Actions -->
            <td>
              <div class="btn-group">
                <form
                  th:action="@{/attendance/updateStatus}"
                  method="post"
                  class="d-inline"
                >
                  <input
                    type="hidden"
                    name="recordId"
                    th:value="${record.id}"
                  />
                  <select name="newStatus" class="form-select form-select-sm">
                    <option
                      th:each="s : ${T(com.springboot.domesticworkregistry.enums.AttendanceStatus).values()}"
                      th:value="${s}"
                      th:text="${s.label}"
                      th:selected="${s == record.attendanceStatus}"
                    ></option>
                  </select>
                  <button type="submit" class="btn btn-primary btn-sm mt-1">
                    Guardar
                  </button>
                </form>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
