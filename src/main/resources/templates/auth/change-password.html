<!DOCTYPE html>
<html
  lang="es"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragments/layout}"
>
  <head>
    <title>Cambiar Contraseña | DomesticWork</title>
  </head>

  <body>
    <div layout:fragment="content">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">
          <i class="bi bi-key-fill me-3 text-primary"></i>
          Cambiar Contraseña
        </h1>
        <p class="page-subtitle">
          Actualizá tu contraseña para mantener tu cuenta segura
        </p>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-6">
          <!-- Security Tips Card -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">
                <i class="bi bi-shield-check text-success me-2"></i>
                Consejos de Seguridad
              </h5>
              <ul class="mb-0" style="padding-left: 1.25rem">
                <li class="mb-2">Usá al menos 8 caracteres</li>
                <li class="mb-2">Incluí mayúsculas, minúsculas y números</li>
                <li class="mb-2">No uses información personal obvia</li>
                <li class="mb-0">Evitá contraseñas que ya hayas usado antes</li>
              </ul>
            </div>
          </div>

          <!-- Change Password Form -->
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="bi bi-lock-fill me-2"></i>
                Actualizar Contraseña
              </h5>
            </div>
            <div class="card-body">
              <!-- Error Message -->
              <div
                th:if="${errorMessage}"
                class="alert alert-danger d-flex align-items-center"
                role="alert"
              >
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span th:text="${errorMessage}"></span>
              </div>

              <!-- Success Message -->
              <div
                th:if="${successMessage}"
                class="alert alert-success d-flex align-items-center"
                role="alert"
              >
                <i class="bi bi-check-circle-fill me-2"></i>
                <span th:text="${successMessage}"></span>
              </div>

              <form
                th:action="@{/users/change-password}"
                th:object="${passwordForm}"
                method="post"
              >
                <!-- Current Password -->
                <div class="mb-4">
                  <label for="currentPassword" class="form-label">
                    <i class="bi bi-lock me-1"></i>
                    Contraseña Actual
                  </label>
                  <input
                    type="password"
                    th:field="*{currentPassword}"
                    class="form-control"
                    th:classappend="${#fields.hasErrors('currentPassword')} ? 'is-invalid'"
                    placeholder="Ingresá tu contraseña actual"
                    required
                  />
                  <div
                    th:if="${#fields.hasErrors('currentPassword')}"
                    class="invalid-feedback d-flex align-items-center gap-2"
                  >
                    <i class="bi bi-exclamation-circle-fill"></i>
                    <span th:errors="*{currentPassword}"></span>
                  </div>
                </div>

                <!-- Divider -->
                <hr class="my-4" />

                <!-- New Password -->
                <div class="mb-3">
                  <label for="newPassword" class="form-label">
                    <i class="bi bi-key me-1"></i>
                    Nueva Contraseña
                  </label>
                  <input
                    type="password"
                    th:field="*{newPassword}"
                    class="form-control"
                    th:classappend="${#fields.hasErrors('newPassword')} ? 'is-invalid'"
                    placeholder="Ingresá tu nueva contraseña"
                    required
                  />
                  <div
                    th:if="${#fields.hasErrors('newPassword')}"
                    class="invalid-feedback d-flex align-items-center gap-2"
                  >
                    <i class="bi bi-exclamation-circle-fill"></i>
                    <span th:errors="*{newPassword}"></span>
                  </div>
                </div>

                <!-- Repeat New Password -->
                <div class="mb-4">
                  <label for="repeatNewPassword" class="form-label">
                    <i class="bi bi-key me-1"></i>
                    Repetir Nueva Contraseña
                  </label>
                  <input
                    type="password"
                    th:field="*{repeatNewPassword}"
                    class="form-control"
                    th:classappend="${#fields.hasErrors('repeatNewPassword')} ? 'is-invalid'"
                    placeholder="Repetí tu nueva contraseña"
                    required
                  />
                  <div
                    th:if="${#fields.hasErrors('repeatNewPassword')}"
                    class="invalid-feedback d-flex align-items-center gap-2"
                  >
                    <i class="bi bi-exclamation-circle-fill"></i>
                    <span th:errors="*{repeatNewPassword}"></span>
                  </div>
                </div>

                <!-- Global Errors (password mismatch) -->
                <div
                  th:if="${#fields.hasGlobalErrors()}"
                  class="alert alert-danger d-flex align-items-center mb-4"
                >
                  <i class="bi bi-exclamation-triangle-fill me-2"></i>
                  <div>
                    <div
                      th:each="err : ${#fields.globalErrors()}"
                      th:text="${err}"
                    ></div>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary flex-grow-1">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    Cambiar Contraseña
                  </button>
                  <a th:href="@{/dashboard}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle me-2"></i>
                    Cancelar
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
